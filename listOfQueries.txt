API Endpoints and Their SQL Queries (Dremio Format)

1. GET /waterbase/aggregated

Without country filter:
SELECT * FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_AggregatedData\"
ORDER BY phenomenonTimeReferenceYear DESC
LIMIT {limit}

With country filter:
SELECT * FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_AggregatedData\"
WHERE countryCode = '{country_code}'
ORDER BY phenomenonTimeReferenceYear DESC
LIMIT {limit}

2. GET /waterbase/disaggregated

Without country filter:
SELECT * FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_DisaggregatedData\"
LIMIT {limit}

With country filter:
SELECT * FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_DisaggregatedData\"
WHERE countryCode = '{country_code}'
LIMIT {limit}

3. GET /waterbase/country/{country_code}

SELECT t1.* FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_AggregatedData\" t1
INNER JOIN (
    SELECT observedPropertyDeterminandCode,
           MAX(phenomenonTimeReferenceYear) as max_year
    FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_AggregatedData\"
    WHERE countryCode = '{country_code}'
    GROUP BY observedPropertyDeterminandCode
) t2 ON t1.observedPropertyDeterminandCode = t2.observedPropertyDeterminandCode
   AND t1.phenomenonTimeReferenceYear = t2.max_year
WHERE t1.countryCode = '{country_code}'
ORDER BY t1.observedPropertyDeterminandLabel

4. GET /waterbase/site/{site_identifier}

SELECT t1.* FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_AggregatedData\" t1
INNER JOIN (
    SELECT observedPropertyDeterminandCode,
           MAX(phenomenonTimeReferenceYear) as max_year
    FROM \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest.\"Waterbase_T_WISE6_AggregatedData\"
    WHERE monitoringSiteIdentifier = '{site_identifier}'
    GROUP BY observedPropertyDeterminandCode
) t2 ON t1.observedPropertyDeterminandCode = t2.observedPropertyDeterminandCode
   AND t1.phenomenonTimeReferenceYear = t2.max_year
WHERE t1.monitoringSiteIdentifier = '{site_identifier}'
ORDER BY t1.observedPropertyDeterminandLabel

Notes:
- All queries target the Dremio path: \"Local S3\".\"datahub-pre-01\".discodata.\"WISE_SOE\".latest
- {limit}, {country_code}, and {site_identifier} are replaced with actual values at runtime
- GET /healthCheck and GET /coordinates/country/{country_code} do not use Dremio queries